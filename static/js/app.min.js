!function(){"use strict";angular.module("project-staffing",["ngRoute","ngAutocomplete","employee-directives","ngAnimate"])}(),function(){"use strict";var e=angular.module("employee-directives",[]);e.directive("navigation",function(){return{restrict:"E",templateUrl:"navigation.html"}}),e.directive("employeeTable",function(){return{restrict:"E",templateUrl:"employee-table.html"}}),e.directive("employeeList",function(){return{restrict:"E",templateUrl:"employee-list.html"}}),e.directive("employeeForm",function(){return{restrict:"E",templateUrl:"employee-form.html"}}),e.directive("skillForm",function(){return{restrict:"E",templateUrl:"skill-form.html"}}),e.directive("projectForm",function(){return{restrict:"E",templateUrl:"project-form.html"}}),e.directive("homeaddressForm",function(){return{restrict:"E",templateUrl:"homeaddress-form.html"}}),e.directive("searchaddressForm",function(){return{restrict:"E",templateUrl:"searchaddress-form.html"}}),e.directive("customerTable",function(){return{restrict:"E",templateUrl:"customer-table.html"}}),e.directive("searchCustomerAddressForm",function(){return{restrict:"E",templateUrl:"searchcustomeraddress-form.html"}})}(),function(){"use strict";angular.module("project-staffing").config(["$routeProvider",function(e){e.when("/",{templateUrl:"views/index.html"}).when("/timeline",{templateUrl:"views/timeline.html",controller:"TimelineController",controllerAs:"timelineCtrl"}).when("/dashboard",{templateUrl:"views/dashboard.html",controller:"DashboardController",controllerAs:"dashboardCtrl"}).when("/list-employees",{templateUrl:"views/list_employees.html",controller:"EmployeeController",controllerAs:"employeeCtrl"}).when("/add-employee",{templateUrl:"views/add_employee.html",controller:"EmployeeController",controllerAs:"employeeCtrl"}).when("/list-customers",{templateUrl:"views/list_customers.html",controller:"CustomerController",controllerAs:"customerCtrl"}).when("/staffing",{templateUrl:"views/staff_project.html",controller:"StaffingController",controllerAs:"staffingCtrl"}).when("/add-customer",{templateUrl:"views/add_customer.html",controller:"CustomerController",controllerAs:"customerCtrl"}).when("/help",{templateUrl:"views/help.html"}).otherwise({redirectTo:"/"})}])}(),function(){"use strict";angular.module("project-staffing").controller("AddressController",["$http","$scope",function(e,t){t.result="",t.details={},t.options={},t.form={type:"geocode",watchEnter:!0},this.saveAddress=function(o){console.log("update existing employee"),console.log(t.details);var l=Object.keys(t.details.geometry.location);o.homeaddress={},o.homeaddress.longitude=t.details.geometry.location[l[0]],o.homeaddress.latitude=t.details.geometry.location[l[1]],e.post("http://localhost:9000/api/mongo/employees/"+o._id,JSON.stringify(o));var s="max",a="updated the address of an existing employee ",i={timestamp:new Date,subject:s,action:a,object:o.name};e.post("http://localhost:9000/api/mongo/activities",JSON.stringify(i))}}])}(),function(){"use strict";angular.module("project-staffing").controller("CustomerController",["$http","$scope","$filter",function(e,t){function o(){console.log("initialze map");var e={zoom:9,center:a,mapTypeId:google.maps.MapTypeId.ROADMAP},t=new google.maps.Map(document.getElementById("map-canvas"),e);if(s){var o={strokeColor:"#4CC417",strokeOpacity:.8,strokeWeight:2,fillColor:"#4CC417",fillOpacity:.35,map:t,center:a,radius:5e4};new google.maps.Circle(o),new google.maps.Marker({position:a,map:t,title:"Found Address"})}var l,n,c,m=new google.maps.InfoWindow;for(n=0;n<r.length;n++)c=r[n],l=new google.maps.Marker({position:new google.maps.LatLng(c.companyaddress.longitude,c.companyaddress.latitude),map:t,icon:i,title:c.company}),google.maps.event.addListener(l,"click",function(e,o){return function(){var l=r[o],s="<p><b>"+l.company+'</b></p><table class="table"><tr>';s+='<tr><td><span class="label label-primary">Industry</span></td><td>'+l.industry+"</td></tr>",s+='<tr><td><span class="label label-primary">Address</span></td><td>'+l.address+"</td></tr></table>",m.setContent(s),m.open(t,e)}}(l,n))}console.log("Customer Controller");var l=this;l.customers=[];var s=!1;this.customer={},t.details={},t.options={},t.form={type:"geocode",watchEnter:!0},e.get("http://localhost:9000/api/mongo/customers").success(function(e){console.log("Get all customers from backend"),console.log(e),l.customers=e}),this.addCustomer=function(){console.log("add customer"),this.customer.companyaddress={};var o=Object.keys(t.details.geometry.location);this.customer.companyaddress.longitude=t.details.geometry.location[o[0]],this.customer.companyaddress.latitude=t.details.geometry.location[o[1]];var s="jon",a="created a new customer",i={timestamp:new Date,subject:s,action:a,object:this.customer.company};e.post("http://localhost:9000/api/mongo/customers",JSON.stringify(this.customer)),e.post("http://localhost:9000/api/mongo/activities",JSON.stringify(i)),e.get("http://localhost:9000/api/mongo/customers").success(function(e){console.log("Get all customers from backend"),l.customers=e,console.log(e)})},this.deleteCustomer=function(t){console.log("delete customer "+t),e.delete("http://localhost:9000/api/mongo/customers/"+t);var o;for(var s in l.customers)console.log(l.customers[s]),console.log(s),l.customers[s]._id===t&&(console.log("Delete item from array"),o=l.customers[s],l.customers.splice(s,1));var a="julia",i="deleted customer",r={timestamp:new Date,subject:a,action:i,object:o.company};e.post("http://localhost:9000/api/mongo/activities",JSON.stringify(r))},this.editCustomer=function(e){for(var t in l.customers)l.customers[t]._id===e&&(console.log("Edit Customer"),this.customer=l.customers[t])},this.resetForm=function(){console.log("reset form"),this.customer={}};var a={lat:51.161295,lng:7.010175000000004},i={url:"img/company-icon.png",size:new google.maps.Size(64,64),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(0,64)};t.details={};var r=[],s=!1;this.searchCustomers=function(){console.log("search customers"),t.details.geometry&&(a=t.details.geometry.location,s=!0);var l="http://localhost:9000/api/mongo/customers";e.get(l).success(function(e){console.log("Get customers from backend"),r=e,o()})},google.maps.event.addDomListener(window,"load",o)}])}(),function(){"use strict";angular.module("project-staffing").controller("DashboardController",["$http","$scope",function(e){console.log("Dashboard Controller");var t=this;t.employees=[],t.latestprojects=[];var o=[["Lat","Long","Office","Revenue","No. Employees","Utilization"],[51.1672852,7.0626139,"Solingen",{v:12,f:"12.0%"},0,85],[51.2111382,6.7822516,"Düsseldorf",{v:7.3,f:"7.3%"},0,65],[48.1368364,11.5234671,"München",{v:3.6,f:"3.6%"},0,75],[52.5083545,13.3771307,"Berlin",{v:2.1,f:"2.1%"},0,86],[49.00367,8.36476,"Karlsruhe",{v:5.4,f:"5.4%"},0,40],[50.0779865,8.6246555,"Frankfurt",{v:3.1,f:"3.1%"},0,55],[53.55539,9.98492,"Hamburg",{v:2.5,f:"2.5%"},0,30],[51.4969802,11.9688029,"Halle (Saale)",{v:-5.1,f:"5.1%"},0,20]];e.get("http://localhost:9000/api/mongo/search/location/employees").success(function(e){console.log("Get employees grouped by location"),t.employees=e;for(var l in o){var s=o[l][2];for(var a in t.employees)if(t.employees[a]._id===s){var i=t.employees[a].total;o[l][4]=i}}var r=google.visualization.arrayToDataTable(o),n=new google.visualization.DataView(r);n.setColumns([0,1]);var c=new google.visualization.DataView(r);c.setColumns([2,3,4,5]);var m=new google.visualization.Table(document.getElementById("table_div")),p=new google.visualization.ArrowFormat;p.format(r,3);var d=new google.visualization.BarFormat({width:150,min:0,max:100});d.format(r,5),m.draw(c,{showRowNumber:!1,allowHtml:!0});var g={mapType:"normal",showTip:!1,enableScrollWheel:!0},u=new google.visualization.Map(document.getElementById("map_div"));u.draw(n,g),google.visualization.events.addListener(m,"select",function(){u.setSelection(m.getSelection())}),google.visualization.events.addListener(u,"select",function(){m.setSelection(u.getSelection())})}),e.get("http://localhost:9000/api/mongo/search/employees/latestproject").success(function(e){console.log("Get latest project for all employees"),t.latestprojects=e;var o=new google.visualization.DataTable;o.addColumn("string","Name"),o.addColumn("string","Office"),o.addColumn("string","Project Name"),o.addColumn("date","Start"),o.addColumn("date","End"),o.addColumn("number","Idle since (days)");for(var l in t.latestprojects){var s=t.latestprojects[l],a=Math.ceil((new Date(s.projects.end)-new Date)/864e5);console.log(a),o.addRow([s.name,s.office,s.projects.name,new Date(s.projects.start),new Date(s.projects.end),a])}var i=new google.visualization.ColorFormat;i.addRange(-1e5,-15,"white","red"),i.addRange(-14,0,"white","orange"),i.addRange(1,60,"black","yellow"),i.addRange(61,1e5,"white","green"),i.format(o,5);var r=new google.visualization.DateFormat({pattern:"yyyy-MM-dd"});r.format(o,3),r.format(o,4);var n=new google.visualization.Table(document.getElementById("latestprojects_div"));n.draw(o,{showRowNumber:!1,allowHtml:!0,sortColumn:4})})}])}(),function(){"use strict";angular.module("project-staffing").controller("EmployeeController",["$http",function(e){var t=this;this.tab=1,this.employees=t.employees,this.employee={},t.employees=[],e.get("http://localhost:9000/api/mongo/employees").success(function(e){console.log("Get all employees from backend"),t.employees=e}),this.showTabs=function(){return console.log("show tabs"),void 0===this.employee._id?!1:!0},this.editEmployee=function(e){for(var t in this.employees)this.employees[t]._id===e&&(console.log("Edit Employee"),this.employee=this.employees[t])},this.resetForm=function(){this.employee={}},this.addEmployee=function(){void 0===this.employee._id?(console.log("add new employee"),e.post("http://localhost:9000/api/mongo/employees",JSON.stringify(this.employee))):(console.log("update existing employee"),e.post("http://localhost:9000/api/mongo/employees/"+this.employee._id,JSON.stringify(this.employee)));var o="jon",l="added a new employee",s={timestamp:new Date,subject:o,action:l,object:this.employee.name};e.post("http://localhost:9000/api/mongo/activities",JSON.stringify(s)),e.get("http://localhost:9000/api/mongo/employees").success(function(e){console.log("Update all employees from backend"),t.employees=e})},this.deleteEmployee=function(t){console.log("Delete employee with id: "+JSON.stringify(t)),e.delete("http://localhost:9000/api/mongo/employees/"+t);var o;for(var l in this.employees)console.log(this.employees[l]),console.log(l),this.employees[l]._id===t&&(o=this.employees[l],console.log("Delete item from array"),this.employees.splice(l,1));var s="max",a="deleted a employee",i={timestamp:new Date,subject:s,action:a,object:o.name};e.post("http://localhost:9000/api/mongo/activities",JSON.stringify(i))}}])}(),function(){"use strict";angular.module("project-staffing").controller("NavigationController",["$scope",function(e){e.active="",e.set=function(t){e.active=t}}])}(),function(){"use strict";angular.module("project-staffing").controller("ProjectController",["$http",function(e){this.deleteProject=function(t,o){console.log("delete project "+t),console.log(o.projects[t]),o.projects.splice(t,1),e.post("http://localhost:9000/api/mongo/employees/"+o._id+"/projects",JSON.stringify(o));var l="julia",s="deleted a project",a={timestamp:new Date,subject:l,action:s,object:o.projects[t].name};e.post("http://localhost:9000/api/mongo/activities",JSON.stringify(a))},this.addProject=function(t){console.log(t),null==t.projects&&(t.projects=[]),t.projects.push(this.project),e.post("http://localhost:9000/api/mongo/employees/"+t._id+"/projects",JSON.stringify(t)),this.project={};var o="maria",l="added a new project",s={timestamp:new Date,subject:o,action:l,object:this.project.name};e.post("http://localhost:9000/api/mongo/activities",JSON.stringify(s))}}])}(),function(){"use strict";angular.module("project-staffing").controller("SkillController",["$http",function(e){this.skill="",this.deleteSkill=function(t,o){console.log("delete skill "+t),console.log(o.skills[t]),o.skills.splice(t,1),e.post("http://localhost:9000/api/mongo/employees/"+o._id+"/skills",JSON.stringify(o));var l="julia",s="deleted skill",a={timestamp:new Date,subject:l,action:s,object:o.skills[t]};e.post("http://localhost:9000/api/mongo/activities",JSON.stringify(a))},this.addSkill=function(t){for(var o in t.skills)if(o===this.skill)return;null==t.skills&&(t.skills=[]),t.skills.push(this.skill),e.post("http://localhost:9000/api/mongo/employees/"+t._id+"/skills",JSON.stringify(t));var l="jon",s="added skill",a={timestamp:new Date,subject:l,action:s,object:this.skill};e.post("http://localhost:9000/api/mongo/activities",JSON.stringify(a)),this.skill=""}}])}(),function(){"use strict";angular.module("project-staffing").controller("StaffingController",["$http","$scope","$filter",function(e,t,o){function l(){console.log("initialze map");var e={zoom:9,center:s,mapTypeId:google.maps.MapTypeId.ROADMAP},t=new google.maps.Map(document.getElementById("map-canvas"),e);if(r){var l={strokeColor:"#4CC417",strokeOpacity:.8,strokeWeight:2,fillColor:"#4CC417",fillOpacity:.35,map:t,center:s,radius:5e4};new google.maps.Circle(l),new google.maps.Marker({position:s,map:t,title:"Selected Customer"})}var n,c,m,p=new google.maps.InfoWindow;for(c=0;c<i.length;c++)m=i[c],n=new google.maps.Marker({position:new google.maps.LatLng(m.homeaddress.longitude,m.homeaddress.latitude),map:t,icon:a,title:m.name}),google.maps.event.addListener(n,"click",function(e,l){return function(){var s=i[l],a="<p><b>"+s.name+"</b></p>";if(s.skills){a+='<p><span class="label label-success">Skills</span><table class="table"><tr><td>';for(var r=0;r<s.skills.length;r++)a+=s.skills[r]+", ";a=a.slice(0,-2),a+="</td></tr></table></p>"}else a+="<br>No skills.";if(s.projects){a+='<p><span class="label label-success">Projects</span><table class="table">',s.projects.sort(function(e,t){return e.start<t.start?1:0});for(var n=0;n<s.projects.length;n++){var c=s.projects[n].start,m=s.projects[n].end;void 0===m&&(m="Current");var d=s.projects[n].name;a+='<tr><td><span class="label label-primary">'+o("date")(c,"yyyy-MM-dd")+"</span></td>",a+='<td><span class="label label-info">'+o("date")(m,"yyyy-MM-dd")+"</span></td><td>"+d+"</td></tr>"}a+="</table></p>"}else a+="<br>No projects.";p.setContent(a),p.open(t,e)}}(n,c))}console.log("Staffing Controller");var s={lat:51.161295,lng:7.010175000000004},a={url:"img/default-face.png",size:new google.maps.Size(64,64),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(0,64)};t.details={},t.skillQuery="";var i=[],r=!1;this.searchCustomer=function(){if(console.log("search customer"),t.details.geometry){var o=Object.keys(t.details.geometry.location);s.lat=t.details.geometry.location[o[0]],s.lng=t.details.geometry.location[o[1]],r=!0}var a="http://localhost:9000/api/mongo/employees";if(t.skillQuery){for(var n=t.skillQuery.toLowerCase().split(","),c="",m=0;m<n.length;m++){var p=n[m].trim();c+="&skills="+p}a="http://localhost:9000/api/mongo/search/employees/skills?"+c}e.get(a).success(function(e){console.log("Get employees from backend"),i=e,l()})},google.maps.event.addDomListener(window,"load",l)}])}(),function(){"use strict";angular.module("project-staffing").controller("TimelineController",["$http",function(e){var t=this;t.list=[],e.get("http://localhost:9000/api/mongo/activities").success(function(e){console.log("Get recent timeline entries"),t.list=e})}])}();