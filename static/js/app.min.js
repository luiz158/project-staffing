!function(){"use strict";angular.module("project-staffing",["ngRoute","ngAutocomplete","employee-directives","ngAnimate"])}(),function(){"use strict";angular.module("project-staffing").controller("AddressController",["$http","$scope","$location",function(e,o,t){var s=t.protocol()+"://"+t.host()+":"+t.port();o.result="",o.details={},o.options={},o.form={type:"geocode",watchEnter:!0},this.saveAddress=function(t){console.log("update existing employee");var l=Object.keys(o.details.geometry.location);t.homeaddress={},t.homeaddress.longitude=o.details.geometry.location[l[0]],t.homeaddress.latitude=o.details.geometry.location[l[1]],e.post(s+"/api/mongo/employees/"+t._id,JSON.stringify(t));var r="max",i="updated the address of an existing employee ",n={timestamp:new Date,subject:r,action:i,object:t.name};e.post(s+"/api/mongo/activities",JSON.stringify(n))}}])}(),function(){"use strict";angular.module("project-staffing").controller("CustomerController",["$http","$scope","$location",function(e,o,t){function s(){console.log("initialze map");var e={zoom:9,center:n,mapTypeId:google.maps.MapTypeId.ROADMAP},o=new google.maps.Map(document.getElementById("map-canvas"),e);if(i){var t={strokeColor:"#4CC417",strokeOpacity:.8,strokeWeight:2,fillColor:"#4CC417",fillOpacity:.35,map:o,center:n,radius:5e4};new google.maps.Circle(t),new google.maps.Marker({position:n,map:o,title:"Found Address"})}var s,l,r,m=new google.maps.InfoWindow;for(l=0;l<c.length;l++)r=c[l],s=new google.maps.Marker({position:new google.maps.LatLng(r.companyaddress.longitude,r.companyaddress.latitude),map:o,icon:a,title:r.company}),google.maps.event.addListener(s,"click",function(e,t){return function(){var s=c[t],l="<p><b>"+s.company+'</b></p><table class="table"><tr>';l+='<tr><td><span class="label label-primary">Industry</span></td><td>'+s.industry+"</td></tr>",l+='<tr><td><span class="label label-primary">Address</span></td><td>'+s.address+"</td></tr></table>",m.setContent(l),m.open(o,e)}}(s,l))}console.log("Customer Controller");var l=t.protocol()+"://"+t.host()+":"+t.port(),r=this;r.customers=[];var i=!1;this.customer={},o.details={},o.options={},o.form={type:"geocode",watchEnter:!0},e.get(l+"/api/mongo/customers").success(function(e){console.log("Get all customers from backend"),console.log(e),r.customers=e}),this.addCustomer=function(){console.log("add customer"),this.customer.companyaddress={};var t=Object.keys(o.details.geometry.location);this.customer.companyaddress.longitude=o.details.geometry.location[t[0]],this.customer.companyaddress.latitude=o.details.geometry.location[t[1]];var s="jon",i="created a new customer",n={timestamp:new Date,subject:s,action:i,object:this.customer.company};e.post(l+"/api/mongo/customers",JSON.stringify(this.customer)),e.post(l+"/api/mongo/activities",JSON.stringify(n)),e.get(l+"/api/mongo/customers").success(function(e){console.log("Get all customers from backend"),r.customers=e,console.log(e)})},this.deleteCustomer=function(o){console.log("delete customer "+o),e.delete(l+"/api/mongo/customers/"+o);var t;for(var s in r.customers)console.log(r.customers[s]),console.log(s),r.customers[s]._id===o&&(console.log("Delete item from array"),t=r.customers[s],r.customers.splice(s,1));var i="julia",n="deleted customer",a={timestamp:new Date,subject:i,action:n,object:t.company};e.post(l+"/api/mongo/activities",JSON.stringify(a))},this.editCustomer=function(e){for(var o in r.customers)r.customers[o]._id===e&&(console.log("Edit Customer"),this.customer=r.customers[o])},this.resetForm=function(){console.log("reset form"),this.customer={}};var n={lat:51.161295,lng:7.010175000000004},a={url:"img/company-icon.png",size:new google.maps.Size(64,64),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(0,64)};o.details={};var c=[];i=!1,this.searchCustomers=function(){console.log("search customers"),o.details.geometry&&(n=o.details.geometry.location,i=!0);var t=l+"/api/mongo/customers";e.get(t).success(function(e){console.log("Get customers from backend"),c=e,s()})},google.maps.event.addDomListener(window,"load",s)}])}(),function(){"use strict";angular.module("project-staffing").controller("DashboardController",["$http","$location",function(e,o){console.log("Dashboard Controller");var t=o.protocol()+"://"+o.host()+":"+o.port(),s=this;s.employees=[],s.latestprojects=[];var l=[["Lat","Long","Office","Revenue","No. Employees","Utilization"],[51.1672852,7.0626139,"Solingen",{v:12,f:"12.0%"},0,85],[51.2111382,6.7822516,"Düsseldorf",{v:7.3,f:"7.3%"},0,65],[48.1368364,11.5234671,"München",{v:3.6,f:"3.6%"},0,75],[52.5083545,13.3771307,"Berlin",{v:2.1,f:"2.1%"},0,86],[49.00367,8.36476,"Karlsruhe",{v:5.4,f:"5.4%"},0,40],[50.0779865,8.6246555,"Frankfurt",{v:3.1,f:"3.1%"},0,55],[53.55539,9.98492,"Hamburg",{v:2.5,f:"2.5%"},0,30],[51.4969802,11.9688029,"Halle (Saale)",{v:-5.1,f:"5.1%"},0,20]];e.get(t+"/api/mongo/search/location/employees").success(function(e){console.log("Get employees grouped by location"),s.employees=e;for(var o in l){var t=l[o][2];for(var r in s.employees)if(s.employees[r]._id===t){var i=s.employees[r].total;l[o][4]=i}}var n=google.visualization.arrayToDataTable(l),a=new google.visualization.DataView(n);a.setColumns([0,1]);var c=new google.visualization.DataView(n);c.setColumns([2,3,4,5]);var m=new google.visualization.Table(document.getElementById("table_div")),p=new google.visualization.ArrowFormat;p.format(n,3);var d=new google.visualization.BarFormat({width:150,min:0,max:100});d.format(n,5),m.draw(c,{showRowNumber:!1,allowHtml:!0});var g={mapType:"normal",showTip:!1,enableScrollWheel:!0},u=new google.visualization.Map(document.getElementById("map_div"));u.draw(a,g),google.visualization.events.addListener(m,"select",function(){u.setSelection(m.getSelection())}),google.visualization.events.addListener(u,"select",function(){m.setSelection(u.getSelection())})}),e.get(t+"/api/mongo/search/employees/latestproject").success(function(e){console.log("Get latest project for all employees"),s.latestprojects=e;var o=new google.visualization.DataTable;o.addColumn("string","Name"),o.addColumn("string","Office"),o.addColumn("string","Project Name"),o.addColumn("date","Start"),o.addColumn("date","End"),o.addColumn("number","Idle since (days)");for(var t in s.latestprojects){var l=s.latestprojects[t],r=Math.ceil((new Date(l.projects.end)-new Date)/864e5);console.log(r),o.addRow([l.name,l.office,l.projects.name,new Date(l.projects.start),new Date(l.projects.end),r])}var i=new google.visualization.ColorFormat;i.addRange(-1e5,-15,"white","red"),i.addRange(-14,0,"white","orange"),i.addRange(1,60,"black","yellow"),i.addRange(61,1e5,"white","green"),i.format(o,5);var n=new google.visualization.DateFormat({pattern:"yyyy-MM-dd"});n.format(o,3),n.format(o,4);var a=new google.visualization.Table(document.getElementById("latestprojects_div"));a.draw(o,{showRowNumber:!1,allowHtml:!0,sortColumn:4})})}])}(),function(){"use strict";angular.module("project-staffing").controller("EmployeeController",["$http","$location",function(e,o){var t=o.protocol()+"://"+o.host()+":"+o.port();console.log("URL "+t);var s=this;this.tab=1,this.employees=s.employees,this.employee={},s.employees=[],e.get(t+"/api/mongo/employees").success(function(e){console.log("Get all employees from backend"),s.employees=e}),this.showTabs=function(){return console.log("show tabs"),void 0===this.employee._id?!1:!0},this.editEmployee=function(e){for(var o in this.employees)this.employees[o]._id===e&&(console.log("Edit Employee"),this.employee=this.employees[o])},this.resetForm=function(){this.employee={}},this.addEmployee=function(){void 0===this.employee._id?(console.log("add new employee"),e.post(t+"/api/mongo/employees",JSON.stringify(this.employee))):(console.log("update existing employee"),e.post(t+"/api/mongo/employees/"+this.employee._id,JSON.stringify(this.employee)));var o="jon",l="added a new employee",r={timestamp:new Date,subject:o,action:l,object:this.employee.name};e.post(t+"/api/mongo/activities",JSON.stringify(r)),e.get(t+"/api/mongo/employees").success(function(e){console.log("Update all employees from backend"),s.employees=e})},this.deleteEmployee=function(o){console.log("Delete employee with id: "+JSON.stringify(o)),e.delete(t+"/api/mongo/employees/"+o);var s;for(var l in this.employees)console.log(this.employees[l]),console.log(l),this.employees[l]._id===o&&(s=this.employees[l],console.log("Delete item from array"),this.employees.splice(l,1));var r="max",i="deleted a employee",n={timestamp:new Date,subject:r,action:i,object:s.name};e.post(t+"/api/mongo/activities",JSON.stringify(n))}}])}(),function(){"use strict";angular.module("project-staffing").controller("NavigationController",["$scope",function(e){e.active="",e.set=function(o){e.active=o}}])}(),function(){"use strict";angular.module("project-staffing").controller("ProjectController",["$http","$location",function(e,o){var t=o.protocol()+"://"+o.host()+":"+o.port();this.deleteProject=function(o,s){console.log("delete project "+o),console.log(s.projects[o]),s.projects.splice(o,1),e.post(t+"/api/mongo/employees/"+s._id+"/projects",JSON.stringify(s));var l="julia",r="deleted a project",i={timestamp:new Date,subject:l,action:r,object:s.projects[o].name};e.post(t+"/api/mongo/activities",JSON.stringify(i))},this.addProject=function(o){console.log(o),null==o.projects&&(o.projects=[]),o.projects.push(this.project),e.post(t+"/api/mongo/employees/"+o._id+"/projects",JSON.stringify(o)),this.project={};var s="maria",l="added a new project",r={timestamp:new Date,subject:s,action:l,object:this.project.name};e.post(t+"/api/mongo/activities",JSON.stringify(r))}}])}(),function(){"use strict";angular.module("project-staffing").controller("SkillController",["$http","$location",function(e,o){var t=o.protocol()+"://"+o.host()+":"+o.port();this.skill="",this.deleteSkill=function(o,s){console.log("delete skill "+o),console.log(s.skills[o]),s.skills.splice(o,1),e.post(t+"/api/mongo/employees/"+s._id+"/skills",JSON.stringify(s));var l="julia",r="deleted skill",i={timestamp:new Date,subject:l,action:r,object:s.skills[o]};e.post(t+"/api/mongo/activities",JSON.stringify(i))},this.addSkill=function(o){for(var s in o.skills)if(s===this.skill)return;null==o.skills&&(o.skills=[]),o.skills.push(this.skill),e.post(t+"/api/mongo/employees/"+o._id+"/skills",JSON.stringify(o));var l="jon",r="added skill",i={timestamp:new Date,subject:l,action:r,object:this.skill};e.post(t+"/api/mongo/activities",JSON.stringify(i)),this.skill=""}}])}(),function(){"use strict";angular.module("project-staffing").controller("StaffingController",["$http","$scope","$filter","$location",function(e,o,t,s){function l(){console.log("initialze map");var e={zoom:9,center:i,mapTypeId:google.maps.MapTypeId.ROADMAP},o=new google.maps.Map(document.getElementById("map-canvas"),e);if(c){var s={strokeColor:"#4CC417",strokeOpacity:.8,strokeWeight:2,fillColor:"#4CC417",fillOpacity:.35,map:o,center:i,radius:5e4};new google.maps.Circle(s),new google.maps.Marker({position:i,map:o,title:"Selected Customer"})}var l,r,m,p=new google.maps.InfoWindow;for(r=0;r<a.length;r++)m=a[r],l=new google.maps.Marker({position:new google.maps.LatLng(m.homeaddress.longitude,m.homeaddress.latitude),map:o,icon:n,title:m.name}),google.maps.event.addListener(l,"click",function(e,s){return function(){var l=a[s],r="<p><b>"+l.name+"</b></p>";if(l.skills){r+='<p><span class="label label-success">Skills</span><table class="table"><tr><td>';for(var i=0;i<l.skills.length;i++)r+=l.skills[i]+", ";r=r.slice(0,-2),r+="</td></tr></table></p>"}else r+="<br>No skills.";if(l.projects){r+='<p><span class="label label-success">Projects</span><table class="table">',l.projects.sort(function(e,o){return e.start<o.start?1:0});for(var n=0;n<l.projects.length;n++){var c=l.projects[n].start,m=l.projects[n].end;void 0===m&&(m="Current");var d=l.projects[n].name;r+='<tr><td><span class="label label-primary">'+t("date")(c,"yyyy-MM-dd")+"</span></td>",r+='<td><span class="label label-info">'+t("date")(m,"yyyy-MM-dd")+"</span></td><td>"+d+"</td></tr>"}r+="</table></p>"}else r+="<br>No projects.";p.setContent(r),p.open(o,e)}}(l,r))}console.log("Staffing Controller");var r=s.protocol()+"://"+s.host()+":"+s.port(),i={lat:51.161295,lng:7.010175000000004},n={url:"img/default-face.png",size:new google.maps.Size(64,64),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(0,64)};o.details={},o.skillQuery="";var a=[],c=!1;this.searchCustomer=function(){if(console.log("search customer"),o.details.geometry){var t=Object.keys(o.details.geometry.location);i.lat=o.details.geometry.location[t[0]],i.lng=o.details.geometry.location[t[1]],c=!0}var s=r+"/api/mongo/employees";if(o.skillQuery){for(var n=o.skillQuery.toLowerCase().split(","),m="",p=0;p<n.length;p++){var d=n[p].trim();m+="&skills="+d}s=r+"/api/mongo/search/employees/skills?"+m}e.get(s).success(function(e){console.log("Get employees from backend"),a=e,l()})},google.maps.event.addDomListener(window,"load",l)}])}(),function(){"use strict";angular.module("project-staffing").controller("TimelineController",["$http","$location",function(e,o){var t=o.protocol()+"://"+o.host()+":"+o.port(),s=this;s.list=[],e.get(t+"/api/mongo/activities").success(function(e){console.log("Get recent timeline entries"),s.list=e})}])}(),function(){"use strict";var e=angular.module("employee-directives",[]);e.directive("navigation",function(){return{restrict:"E",templateUrl:"navigation.html"}}),e.directive("employeeTable",function(){return{restrict:"E",templateUrl:"employee-table.html"}}),e.directive("employeeList",function(){return{restrict:"E",templateUrl:"employee-list.html"}}),e.directive("employeeForm",function(){return{restrict:"E",templateUrl:"employee-form.html"}}),e.directive("skillForm",function(){return{restrict:"E",templateUrl:"skill-form.html"}}),e.directive("projectForm",function(){return{restrict:"E",templateUrl:"project-form.html"}}),e.directive("homeaddressForm",function(){return{restrict:"E",templateUrl:"homeaddress-form.html"}}),e.directive("searchaddressForm",function(){return{restrict:"E",templateUrl:"searchaddress-form.html"}}),e.directive("customerTable",function(){return{restrict:"E",templateUrl:"customer-table.html"}}),e.directive("searchCustomerAddressForm",function(){return{restrict:"E",templateUrl:"searchcustomeraddress-form.html"}})}(),function(){"use strict";angular.module("project-staffing").config(["$routeProvider",function(e){e.when("/",{templateUrl:"views/index.html"}).when("/timeline",{templateUrl:"views/timeline.html",controller:"TimelineController",controllerAs:"timelineCtrl"}).when("/dashboard",{templateUrl:"views/dashboard.html",controller:"DashboardController",controllerAs:"dashboardCtrl"}).when("/list-employees",{templateUrl:"views/list_employees.html",controller:"EmployeeController",controllerAs:"employeeCtrl"}).when("/add-employee",{templateUrl:"views/add_employee.html",controller:"EmployeeController",controllerAs:"employeeCtrl"}).when("/list-customers",{templateUrl:"views/list_customers.html",controller:"CustomerController",controllerAs:"customerCtrl"}).when("/staffing",{templateUrl:"views/staff_project.html",controller:"StaffingController",controllerAs:"staffingCtrl"}).when("/add-customer",{templateUrl:"views/add_customer.html",controller:"CustomerController",controllerAs:"customerCtrl"}).when("/help",{templateUrl:"views/help.html"}).otherwise({redirectTo:"/"})}])}();